"use client";
import { useEffect, useState } from 'react'; import AxiomTree from '@/components/AxiomTree'; import TaxonomyModal from '@/components/TaxonomyModal'; import DiagramModal from '@/components/DiagramModal';
type Details={ok:boolean;id:string;term:string;fsn:string;active:boolean|null;inferred:any[];stated:any[];raw?:any};
export default function ConceptModal({conceptId,open,onClose}:{conceptId?:string;open:boolean;onClose:()=>void}){ const [data,setData]=useState<Details|null>(null); const [tab,setTab]=useState<'inferred'|'stated'|'json'>('inferred'); const [tax,setTax]=useState(false); const [diag,setDiag]=useState(false); useEffect(()=>{ if(!open||!conceptId) return; setData(null); fetch(`/api/snomed/details?id=${encodeURIComponent(conceptId)}`,{cache:'no-store'}).then(r=>r.json()).then(setData); },[open,conceptId]); if(!open) return null; return(<div className='fixed inset-0 z-50 bg-black/40 flex items-center justify-center'><div className='bg-white w-[min(100%,900px)] rounded-xl shadow-lg overflow-hidden'><div className='px-4 py-3 border-b flex items-center justify-between'><div><div className='text-sm text-gray-500'>SNOMED Concept</div><div className='font-semibold'>{data?.term||conceptId}</div><div className='text-xs text-gray-500'>{data?.fsn||''}</div>{typeof data?.active==='boolean'&&(<span className={`inline-block mt-1 text-xs px-2 py-[2px] rounded ${data.active?'bg-green-100 text-green-800':'bg-red-100 text-red-800'}`}>{data.active?'Active':'Inactive'}</span>)}</div><button className='border rounded px-3 py-1' onClick={onClose}>Close</button></div><div className='px-4 pt-3 flex gap-2 mb-2'><button className={`border rounded px-3 py-1 ${tab==='inferred'?'bg-gray-100':''}`} onClick={()=>setTab('inferred')}>Inferred</button><button className={`border rounded px-3 py-1 ${tab==='stated'?'bg-gray-100':''}`} onClick={()=>setTab('stated')}>Stated</button><button className={`border rounded px-3 py-1 ${tab==='json'?'bg-gray-100':''}`} onClick={()=>setTab('json')}>JSON</button><button className='ml-2 border rounded px-3 py-1' onClick={()=>setTax(true)}>Taxonomy…</button><button className='border rounded px-3 py-1' onClick={()=>setDiag(true)}>SVG Diagram…</button></div><div className='p-4 overflow-auto max-h-[70vh]'>{!data&&<div className='text-sm text-gray-500'>Loading…</div>}{data&&(tab==='json'?<pre className='text-xs bg-gray-50 p-3 rounded overflow-auto'>{JSON.stringify(data.raw||data,null,2)}</pre>:<AxiomTree title={`${tab==='inferred'?'Inferred':'Stated'} relationships`} rels={(tab==='inferred'?data.inferred:data.stated)||[]}/>)}</div><TaxonomyModal open={tax} conceptId={conceptId} onClose={()=>setTax(false)} /><DiagramModal open={diag} conceptId={conceptId} onClose={()=>setDiag(false)} /></div></div>); }
