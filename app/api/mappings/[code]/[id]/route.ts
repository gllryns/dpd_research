import { NextRequest, NextResponse } from 'next/server'; import { getDb } from '@/lib/db'; import { ObjectId } from 'mongodb'; import { requireAuth } from '@/lib/session';
export async function PUT(req:NextRequest,{params}:{params:{code:string,id:string}}){ await requireAuth(req); const db=await getDb(); const body=await req.json(); const _id=new ObjectId(params.id); await db.collection('mappings').updateOne({_id,dpdIngredientCode:params.code},{$set:{...body,updatedAt:new Date()}}); return NextResponse.json(await db.collection('mappings').findOne({_id})); }
export async function DELETE(req:NextRequest,{params}:{params:{code:string,id:string}}){ await requireAuth(req); const db=await getDb(); const _id=new ObjectId(params.id); await db.collection('mappings').deleteOne({_id,dpdIngredientCode:params.code}); return NextResponse.json({ok:true}); }
