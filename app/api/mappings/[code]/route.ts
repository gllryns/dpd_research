import { NextRequest, NextResponse } from 'next/server'; import { getDb } from '@/lib/db'; import { requireAuth } from '@/lib/session';
export async function GET(req:NextRequest,{params}:{params:{code:string}}){ await requireAuth(req); const db=await getDb(); const items=await db.collection('mappings').find({dpdIngredientCode:params.code}).sort({updatedAt:-1}).toArray(); return NextResponse.json({items}); }
export async function POST(req:NextRequest,{params}:{params:{code:string}}){ await requireAuth(req); const db=await getDb(); const body=await req.json(); const doc={dpdIngredientCode:params.code,snomedId:body.snomedId||'',snomedTerm:body.snomedTerm||'',correlation:body.correlation||'exact',status:body.status||'draft',notes:body.notes||'',updatedAt:new Date()}; const r=await db.collection('mappings').insertOne(doc); return NextResponse.json(await db.collection('mappings').findOne({_id:r.insertedId}),{status:201}); }
