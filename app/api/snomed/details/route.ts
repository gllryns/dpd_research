import { NextRequest, NextResponse } from 'next/server'; import { requireAuth } from '@/lib/session'; import { conceptUrl } from '@/lib/snowstorm';
export async function GET(req:NextRequest){ await requireAuth(req); const id=new URL(req.url).searchParams.get('id'); const base=id?conceptUrl(id):null; if(!id||!base) return NextResponse.json({ok:false},{status:400}); const inf=encodeURIComponent('fsn(),pt(),relationships(active=true,form=INFERRED,expand(type(),target()))'); const sta=encodeURIComponent('relationships(active=true,form=STATED,expand(type(),target()))'); const r1=await fetch(`${base}?expand=${inf}`,{cache:'no-store'}); const c1=await r1.json(); const r2=await fetch(`${base}?expand=${sta}`,{cache:'no-store'}); const c2=await r2.json(); return NextResponse.json({ok:true,id,term:c1?.pt?.term||c1?.fsn?.term||'',fsn:c1?.fsn?.term||'',active:c1?.active??null,inferred:c1?.relationships||[],stated:c2?.relationships||[],raw:c1}); }
