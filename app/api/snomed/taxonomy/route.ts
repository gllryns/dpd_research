import { NextRequest, NextResponse } from 'next/server'; import { requireAuth } from '@/lib/session'; import { conceptUrl, parentsUrl, childrenUrl } from '@/lib/snowstorm';
export async function GET(req:NextRequest){ await requireAuth(req); const id=new URL(req.url).searchParams.get('id'); if(!id) return NextResponse.json({ok:false},{status:400}); const r:any={ok:true,id,focus:null,parents:[],children:[]}; const cu=conceptUrl(id); if(cu){ const rc=await fetch(cu,{cache:'no-store'}); if(rc.ok) r.focus=await rc.json(); } const pu=parentsUrl(id); if(pu){ const rp=await fetch(pu,{cache:'no-store'}); if(rp.ok) r.parents=(await rp.json()).items||[]; } const ch=childrenUrl(id); if(ch){ const rh=await fetch(ch,{cache:'no-store'}); if(rh.ok) r.children=(await rh.json()).items||[]; } return NextResponse.json(r); }
