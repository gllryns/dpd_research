import { NextRequest, NextResponse } from 'next/server'; import { setSession } from '@/lib/session'; import { getDb } from '@/lib/db'; import bcrypt from 'bcryptjs';
export async function POST(req:NextRequest){ const {email,password}=await req.json(); const db=await getDb(); const u=await db.collection('users').findOne({email}); if(u && await bcrypt.compare(password,u.passwordHash||'')){ const res=NextResponse.json({ok:true,role:u.role||null}); return setSession(res,email,u.role||null);} const a=process.env.ADMIN_EMAIL; const p=process.env.ADMIN_PASSWORD; if(email===a&&password===p){ const res=NextResponse.json({ok:true,role:'admin'}); return setSession(res,email,'admin'); } return NextResponse.json({message:'Invalid credentials'},{status:401}); }